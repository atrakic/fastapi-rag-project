name: CI

on: [pull_request, workflow_dispatch]

jobs:
    test-and-lint-nodejs:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
                uses: actions/checkout@v2

            - name: Set up Node.js
                uses: actions/setup-node@v2
                with:
                    node-version: '14'

            - name: Install dependencies
                run: npm install

            - name: Run tests
                run: npm test

            - name: Run linter
                run: npm run lint

    test-and-lint-python:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
                uses: actions/checkout@v2

            - name: Set up Python
                uses: actions/setup-python@v2
                with:
                    python-version: '3.8'

            - name: Install dependencies
                run: |
                    python -m venv venv
                    source venv/bin/activate
                    pip install -r requirements.txt

            - name: Run tests
                run: |
                    source venv/bin/activate
                    pytest

            - name: Run linter
                run: |
                    source venv/bin/activate
                    flake8 .